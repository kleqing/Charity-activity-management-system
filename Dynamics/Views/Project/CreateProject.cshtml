@using Dynamics.Utility
@using Newtonsoft.Json
@model Dynamics.Models.Models.ViewModel.ProjectVM
@inject IHttpContextAccessor Accessor


@{
    ViewData["Title"] = "CreateProject";

}





<div class="container  my-5 pt-12 flex justify-center items-center">
    <div class=" bg-white p-8 rounded-lg shadow-lg">
        <div class="flex justify-center items-center py-5 my-5">
            <h1 class="text-3xl font-semibold mx-5">Create a new project</h1>
            <div class="flex items-center mx-5">
                <span class="text-3xl mr-2 font-semibold">or:</span>
                <a asp-action="CreateProjectByImportData" asp-controller="Project" asp-route-requestId="@Model.RequestID">
                    <button class="bg-gray-600 text-white px-4 font-semibold py-2 rounded text-lg">Import data from request</button>
                </a>
            </div>
        </div>

        <div class="w-full">
            <div class="border border-solid border-gray-500 rounded-box px-5 py-5 w-auto">
                <form class="py-5 px-5" asp-action="CreateProject" asp-controller="Project" enctype="multipart/form-data" method="post">
                    <div>
                        <input asp-for="ProjectID" name="ProjectID" class="hidden">
                        <input asp-for="OrganizationID" name="OrganizationID"  class="hidden">
                        <input asp-for="RequestID" name="RequestID" class="hidden">
                        <input asp-for="ProjectStatus" name="ProjectStatus" class="hidden">
                        <input asp-for="Attachment" name="Attachment" class="hidden">
                       
                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div>
                            <label asp-for="ProjectName" class="block text-base font-medium text-gray-700 mb-1">Enter project name</label>
                            <input asp-for="ProjectName" type="text" id="project-name" class="w-full p-2 border border-gray-300 rounded"
                                   placeholder="Enter your name">
                            <span asp-validation-for="ProjectName" class="text-red-500"></span>

                        </div>

                        <div>
                            <div class="flex items-center">
                                <label class="block text-base font-medium text-gray-700 mb-1 mr-5">Upload project images</label>
                                <div class="flex items-center">
                                    <label for="file-upload" class="file-upload-label px-4 py-2 mx-4 bg-blue-900 text-white rounded text-base">
                                        <span>Choose images</span>
                                    </label>
                                    <input asp-for="Attachment" id="file-upload" type="file" name="image" class="hidden">
                                </div>
                            </div>

                            <p class="text-sm text-gray-500 mt-3">The images will appear in your project covers and description</p>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label asp-for="ProjectDescription" class="block text-base font-medium text-gray-700 mb-1">
                            Enter project
                            description
                        </label>
                        <textarea asp-for="ProjectDescription" id="project-description" rows="4" class="w-full p-2 border border-gray-300 rounded"
                                  placeholder="Enter your text"></textarea>
                        <span asp-validation-for="ProjectDescription" class="text-red-500"></span>

                    </div>
                    <div class="mb-6">
                        <label asp-for="ProjectEmail" class="block text-base font-medium text-gray-700 mb-1">
                            Enter project contact Email!
                        </label>
                        <input asp-for="ProjectEmail" name="ProjectEmail" type="email" id="project-contact" rows="4" class="w-full p-2 border border-gray-300 rounded"
                                  placeholder="Enter Email">
                    </div>

                    <div class="mb-6">
                        <label asp-for="ProjectPhoneNumber" class="block text-base font-medium text-gray-700 mb-1">
                            Enter project contact Phone!
                        </label>
                        <input asp-for="ProjectPhoneNumber" name="ProjectPhoneNumber" type="tel" id="project-contact" rows="4" class="w-full p-2 border border-gray-300 rounded"
                               placeholder="Enter tel">
                    </div>

                    <div class="mb-6">
                        <label asp-for="ProjectAddress" class="block text-base font-medium text-gray-700 mb-1">
                            Enter project Address!
                        </label>
                        <input asp-for="ProjectAddress" name="ProjectAddress" type="text" rows="4" class="w-full p-2 border border-gray-300 rounded"
                               placeholder="Enter Address">
                        <span asp-validation-for="ProjectAddress" class="text-red-500"></span>


                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div class="w-full">
                            <label asp-for="StartTime" class="block text-base font-medium text-gray-700 mb-1">
                                Select a project start
                                time
                            </label>
                            <input asp-for="StartTime" type="date" id="startDateInput" class="w-full p-2 border rounded">
                            <p class="text-sm text-gray-500 mt-1">
                                The date that your project starts. Before that, your project will
                                continue to receive donations.
                            </p>
                            <span id="notificationMessage" class="text-red-500 text-sm font-bold" style="display:none;"></span>
                        </div>
                        <div class="w-full ">
                            <label asp-for="EndTime" class="block text-base font-medium text-gray-700 mb-1">
                                Select a project end time
                                (estimated)
                            </label>
                            <input asp-for="EndTime" type="date" id="endDateInput" class="w-full p-2 border rounded">

                            <p class="text-sm text-gray-500 mt-1">The estimated date that your project will end.</p>
                            <span id="notificationMessage" class="text-red-500 text-sm font-bold" style="display:none;"></span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div>
                           <label asp-for="LeaderID" class="block text-base font-medium text-gray-700 mb-1">
                                Assign a member to lead this
                                project (Optional)
                            </label>
                            <select asp-for="LeaderID" id="project-lead" class="w-full p-2 border border-gray-300 rounded">
                                <option>Options</option>
                                @foreach (var item in Model.OrganizationVM.OrganizationMember)
                                {
                                    if (item.UserID.Equals(Model.OrganizationVM.CEO.UserID))
                                    {
                                        <option class="text-xl text-black font-semibold" value="@item.UserID">[CEO-Organization-@Model.OrganizationVM.OrganizationName] - [@item.User.UserFullName] - [@item.User.UserEmail] - [@item.UserID]</option>
                                        continue;
                                    }
                                    <option class="text-xl text-black font-semibold" value="@item.UserID">[@item.User.UserFullName] - [@item.User.UserEmail] - [@item.UserID]</option>
                                }
                            </select>
                        </div>
                        <div>
                            <label for="invite-members" class="block text-base font-medium text-gray-700 mb-1">
                                Invite members from your
                                organization
                            </label>
                            <select id="invite-members" class="w-full p-2 border border-gray-300 rounded">
                                <option>Options</option>
                            </select>
                        </div>
                    </div>


                    <div>
                        <div class="py-5">
                            <h1 class="text-2xl text-center font-medium mb-2">Add expected resources to your project</h1>
                        </div>

                        <div class="flex mb-4 justify-around">

                            <div class="w-1\/3 mx-2">
                                <label class="block text-base text-start font-medium text-gray-700 mb-1 mx-5">
                                    Enter resource name
                                </label>
                                <input  class="w-full p-2 mx-5 border border-gray-300 rounded-btn" value="Money">
                                
                            </div>

                            <div class="w-1\/3 mx-2">
                                <label class="block text-base text-start font-medium text-gray-700 mb-1 mx-5">
                                    Expected quantity
                                </label>
                                <input name="expectedQuantity" type="number" value="@ViewBag.ExpectedQuantity" class="w-full p-2 mx-5 border border-gray-300 rounded-btn" placeholder="Enter quantity">

                                @if (ViewBag.MessageExpectedQuantity != null)
                                {
                                    <span class="text-red-500 d-inline-flex">
                                        @ViewBag.MessageExpectedQuantity
                                    </span>

                                }
                            </div>

                            <div class="w-1\/3 mx-2">
                                <div>
                                    <label class="block text-base text-start font-medium text-gray-700 mb-1 mx-5">
                                        Choose currency unit
                                    </label>
                                    <select name="Unit" class="w-full p-2 border border-gray-300 rounded">
                                        <option value="VND">₫ VND - Viet Nam Đong</option>
                                        <optgroup label="Phổ biến">
                                            <option value="USD">$ USD - US Dollar</option>
                                            <option value="EUR">€ EUR - Euro</option>
                                        </optgroup>
                                        <optgroup label="Châu Á">
                                            <option value="JPY">¥ JPY - Japanese Yen</option>
                                            <option value="CNY">¥ CNY - Chinese Yuan</option>
                                            <option value="KRW">₩ KRW - Korean Won</option>
                                            <option value="SGD">S$ SGD - Singapore Dollar</option>
                                            <option value="HKD">HK$ HKD - Hong Kong Dollar</option>
                                            <option value="THB">฿ THB - Thai Baht</option>
                                        </optgroup>
                                        <optgroup label="Khác">
                                            <option value="GBP">£ GBP - British Pound</option>
                                            <option value="AUD">A$ AUD - Australian Dollar</option>
                                            <option value="CAD">C$ CAD - Canadian Dollar</option>
                                            <option value="CHF">Fr CHF - Swiss Franc</option>
                                        </optgroup>
                                    </select>
                                    
                                </div>

                                
                            </div>
                        </div>
                    </div>

                    
                    
                    <div class="flex justify-center py-5">
                        <button class=" bg-green-500 text-white py-3 px-3 rounded" type="submit">Create new project</button>
                    </div>
                </form>
            </div>
        </div>
        
    </div>
</div>

<script>
 //------------validate date-------------
         document.addEventListener('DOMContentLoaded', function () {
        // Cache DOM elements
        const startDateInput = document.getElementById('startDateInput');
        const endDateInput = document.getElementById('endDateInput');
        const notificationMessage = document.getElementById('notificationMessage');

        let oldStartDate = startDateInput.value;
        let oldEndDate = endDateInput.value;

        // Show old date before changes
        startDateInput.addEventListener('focus', function () {
            oldStartDate = startDateInput.value;
        });

        endDateInput.addEventListener('focus', function () {
            oldEndDate = endDateInput.value;
        });

        // Validate dates
        function validateDates() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            // Clear any previous messages
            notificationMessage.style.display = 'none';
            notificationMessage.innerText = '';

            // Check if start date is greater than end date
            if (startDate > endDate) {
                notificationMessage.style.display = 'block';
                notificationMessage.innerText = `Start date (${startDateInput.value}) cannot be after the end date (${endDateInput.value})`;
                return false;
            }

            // Check if end date is smaller than start date
            if (endDate < startDate) {
                notificationMessage.style.display = 'block';
                notificationMessage.innerText = `End date (${endDateInput.value}) cannot be before the start date (${startDateInput.value})`;
                return false;
            }

            return true;
        }

        // Validate when user changes the start or end date
        startDateInput.addEventListener('change', validateDates);
        endDateInput.addEventListener('change', validateDates);

        // Form submit validation
        document.querySelector('form').addEventListener('submit', function (event) {
            if (!validateDates()) {
                event.preventDefault(); // Prevent form submission if validation fails
            }
        });
    });
</script>
